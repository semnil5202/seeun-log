---
/** PC 전용 헤더. 로고, 카테고리 네비게이션, 언어 선택, 검색을 포함한다. */

import { getCategoryTree } from "@/shared/lib/i18n/categories";
import { getLocalePath } from "@/shared/lib/i18n/locales";
import { t } from "@/shared/lib/i18n/translations";
import { LOCALES, LOCALE_LABELS, DEFAULT_LOCALE } from "@/shared/types/common";
import type { Locale } from "@/shared/types/common";
import { CATEGORY_SLUGS, type CategorySlug } from "@/shared/types/category";

interface Props {
  locale: Locale;
  path: string;
}

const { locale, path } = Astro.props;

const categories = getCategoryTree(locale);
const homeHref = getLocalePath("/", locale);

const segments = Astro.url.pathname.split("/").filter(Boolean);
if (locale !== DEFAULT_LOCALE && segments[0] === locale) segments.shift();
const activeCategory: CategorySlug | null =
  CATEGORY_SLUGS.includes(segments[0] as CategorySlug) ? (segments[0] as CategorySlug) : null;
---

<header class="w-full bg-white border-b border-gray-200">
  <div class="max-w-7xl mx-auto px-6 h-16 flex items-center gap-8">

    <a
      href={homeHref}
      class="shrink-0 text-title1 font-bold text-primary-600 tracking-tight hover:text-primary-700 transition-colors duration-150"
      aria-label="세은로그 홈으로 이동"
    >
      세은로그
    </a>

    <nav aria-label="Main navigation" class="flex items-center gap-1">
      {
        categories.map((category, index) => (
          <>
            <a
              href={getLocalePath(`/${category.slug}/`, locale)}
              class:list={[
                "px-3 py-1.5 text-body2 font-semibold transition-colors duration-150 rounded-md hover:bg-primary-50",
                activeCategory === category.slug
                  ? "text-primary-600"
                  : "text-gray-700 hover:text-primary-500",
              ]}
              aria-current={activeCategory === category.slug ? "true" : undefined}
            >
              {category.label}
            </a>
            {index < categories.length - 1 && (
              <span class="text-gray-300 select-none" aria-hidden="true">|</span>
            )}
          </>
        ))
      }
    </nav>

    <div class="ml-auto flex items-center gap-4">

      <details class="relative group">
        <summary
          class="flex items-center gap-1.5 text-body2 text-gray-600 hover:text-primary-500 transition-colors duration-150 cursor-pointer list-none select-none"
          aria-label={t("nav.language", locale)}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="2" y1="12" x2="22" y2="12" />
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
          </svg>
          <span>{LOCALE_LABELS[locale]}</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3 transition-transform duration-150 group-open:rotate-180"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </summary>

        <div class="absolute right-0 top-full mt-2 w-44 bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50">
          {
            LOCALES.map((loc) => (
              <a
                href={getLocalePath(path, loc)}
                class={`block px-4 py-2 text-body2 transition-colors duration-100 ${
                  loc === locale
                    ? "text-primary-500 font-semibold bg-primary-50"
                    : "text-gray-700 hover:bg-gray-50 hover:text-primary-500"
                }`}
                hreflang={loc}
                lang={loc}
              >
                {LOCALE_LABELS[loc]}
              </a>
            ))
          }
        </div>
      </details>

      <a
        href={getLocalePath("/search/", locale)}
        class="flex items-center justify-center w-8 h-8 text-gray-600 hover:text-primary-500 transition-colors duration-150 rounded-md hover:bg-primary-50"
        aria-label={t("nav.search", locale)}
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
      </a>

    </div>
  </div>
</header>
