---
/**
 * Breadcrumb.astro
 *
 * Visual breadcrumb navigation for post detail pages.
 *
 * SEO: Outputs schema-compatible <ol> structure that mirrors the JSON-LD
 *      BreadcrumbList emitted by the page's <head>. The last item (current page)
 *      is not linked, marked with aria-current="page", and carries no href to
 *      avoid self-referential anchor confusion.
 *
 * Accessibility: <nav aria-label="breadcrumb"> provides a named landmark.
 *   aria-current="page" on the final item signals the active location.
 *
 * i18n: Passes href values through getLocalePath so locale-prefixed URLs are
 *   generated consistently with the rest of the site routing.
 *
 * PERF: Pure static Astro — zero JS, renders at build time with no hydration cost.
 */
import type { BreadcrumbItem } from "@/shared/types/seo";
import type { Locale } from "@/shared/types/common";
import { getLocalePath } from "@/shared/lib/i18n/locales";

interface Props {
  /** Ordered list of breadcrumb items from root to current page */
  items: BreadcrumbItem[];
  locale: Locale;
}

const { items, locale } = Astro.props;
---

<nav aria-label="breadcrumb" class="w-full">
  <ol
    class="flex flex-wrap items-center gap-x-1 gap-y-1 text-sm text-gray-500"
    itemscope
    itemtype="https://schema.org/BreadcrumbList"
  >
    {items.map((item, idx) => {
      const isLast = idx === items.length - 1;
      /**
       * SEO: Use getLocalePath so breadcrumb URLs include the locale prefix.
       * The BreadcrumbItem.url should already be a root-relative path
       * (e.g. `/delicious/korean/`); getLocalePath prepends the locale prefix
       * for non-Korean locales.
       */
      const localizedHref = getLocalePath(item.url, locale);

      return (
        <li
          class="flex items-center gap-x-1"
          itemprop="itemListElement"
          itemscope
          itemtype="https://schema.org/ListItem"
        >
          {isLast ? (
            <span
              class="font-medium text-gray-800 truncate max-w-[200px]"
              aria-current="page"
              itemprop="name"
            >
              {item.name}
            </span>
          ) : (
            <>
              <a
                href={localizedHref}
                class="hover:text-primary-600 hover:underline underline-offset-2 transition-colors truncate max-w-[120px]"
                itemprop="item"
              >
                <span itemprop="name">{item.name}</span>
              </a>

              {/* Separator — aria-hidden so screen readers skip decorative slash */}
              <span class="text-gray-300 select-none" aria-hidden="true">/</span>
            </>
          )}

          {/* Schema.org position — 1-indexed */}
          <meta itemprop="position" content={String(idx + 1)} />
        </li>
      );
    })}
  </ol>
</nav>
