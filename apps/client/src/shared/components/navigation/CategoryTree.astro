---
/**
 * CategoryTree.astro
 *
 * Shared navigation component used by:
 *   - LeftSidebar (PC): always visible as LNB
 *   - Footer (Mobile): full sitemap for SEO crawlers
 *
 * The tree is always fully expanded — no accordion, no JS collapse.
 * Each category and subcategory is an <a> tag for crawler visibility.
 *
 * PERF: Pure static HTML — zero JavaScript, no hydration cost.
 * SEO:  Semantic <nav> with <ul>/<li> gives crawlers a clear link graph.
 */

import { getCategoryTree } from "@/shared/lib/i18n/categories";
import { getLocalePath } from "@/shared/lib/i18n/locales";
import { DEFAULT_LOCALE } from "@/shared/types/common";
import type { Locale } from "@/shared/types/common";
import { CATEGORY_SLUGS, type CategorySlug } from "@/shared/types/category";

interface Props {
  locale: Locale;
  class?: string;
}

const { locale, class: className } = Astro.props;

const categories = getCategoryTree(locale);

const segments = Astro.url.pathname.split("/").filter(Boolean);
if (locale !== DEFAULT_LOCALE && segments[0] === locale) segments.shift();
const activeCategory: CategorySlug | null =
  CATEGORY_SLUGS.includes(segments[0] as CategorySlug) ? (segments[0] as CategorySlug) : null;
const activeSubCategory: string | null = activeCategory && segments[1] ? segments[1] : null;
---

<!--
  Semantic <nav> with aria-label distinguishes this from other nav regions
  on the same page (header nav vs sidebar nav vs footer nav).
-->
<nav aria-label="Category navigation" class={className}>
  <ul class="space-y-4" role="list">
    {
      categories.map((category) => (
        <li class="rounded-lg py-2 pr-2 pl-4 -mx-2 transition-colors duration-150 [&:has(>a:hover)]:bg-primary-50">
          <a
            href={getLocalePath(`/${category.slug}/`, locale)}
            class:list={[
              "block font-semibold transition-colors duration-150 text-body2 uppercase tracking-wide",
              activeCategory === category.slug
                ? "text-primary-600"
                : "text-gray-900 hover:text-primary-500",
            ]}
            aria-current={activeCategory === category.slug ? "true" : undefined}
          >
            {category.label}
          </a>

          <ul class="mt-2 ml-3 space-y-1 border-l border-gray-200 pl-3" role="list">
            {category.subCategories.map((sub) => (
              <li>
                <a
                  href={getLocalePath(`/${category.slug}/${sub.slug}/`, locale)}
                  class:list={[
                    "block text-body2 transition-colors duration-150 py-0.5 px-2 -mx-2 rounded-md hover:bg-primary-50",
                    activeCategory === category.slug && activeSubCategory === sub.slug
                      ? "text-primary-600 font-semibold"
                      : "text-gray-600 hover:text-primary-500",
                  ]}
                  aria-current={activeCategory === category.slug && activeSubCategory === sub.slug ? "page" : undefined}
                >
                  {sub.label}
                </a>
              </li>
            ))}
          </ul>
        </li>
      ))
    }
  </ul>
</nav>
