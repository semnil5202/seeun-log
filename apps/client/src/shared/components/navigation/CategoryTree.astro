---
/** 카테고리/서브카테고리 트리 네비게이션. LeftSidebar(PC LNB)와 Footer(모바일 SEO sitemap)에서 공유한다. */

import { getCategoryTree } from "@/shared/lib/i18n/categories";
import { getLocalePath } from "@/shared/lib/i18n/locales";
import type { Locale } from "@/shared/types/common";
import { getActiveSegments } from "@/shared/lib/navigation";

interface Props {
  locale: Locale;
  class?: string;
}

const { locale, class: className } = Astro.props;

const categories = getCategoryTree(locale);

const { activeCategory, activeSubCategory } = getActiveSegments(Astro.url.pathname, locale);
---

<nav aria-label="Category navigation" class={className}>
  <ul class="space-y-4" role="list">
    {
      categories.map((category) => (
        <li class="rounded-lg py-2 pr-2 pl-4 -mx-2 transition-colors duration-150 [&:has(>a:hover)]:bg-primary-50">
          <a
            href={getLocalePath(`/${category.slug}/`, locale)}
            class:list={[
              "block font-semibold transition-colors duration-150 text-body2 uppercase tracking-wide",
              activeCategory === category.slug
                ? "text-primary-600"
                : "text-gray-900 hover:text-primary-500",
            ]}
            aria-current={activeCategory === category.slug ? "true" : undefined}
          >
            {category.label}
          </a>

          <ul class="mt-2 ml-3 space-y-1 border-l border-gray-200 pl-3" role="list">
            {category.subCategories.map((sub) => (
              <li>
                <a
                  href={getLocalePath(`/${category.slug}/${sub.slug}/`, locale)}
                  class:list={[
                    "block text-body2 transition-colors duration-150 py-0.5 px-2 -mx-2 rounded-md hover:bg-primary-50",
                    activeCategory === category.slug && activeSubCategory === sub.slug
                      ? "text-primary-600 font-semibold"
                      : "text-gray-600 hover:text-primary-500",
                  ]}
                  aria-current={activeCategory === category.slug && activeSubCategory === sub.slug ? "page" : undefined}
                >
                  {sub.label}
                </a>
              </li>
            ))}
          </ul>
        </li>
      ))
    }
  </ul>
</nav>
