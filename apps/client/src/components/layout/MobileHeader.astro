---
/**
 * MobileHeader.astro
 *
 * Mobile-only header rendered inside a `block lg:hidden` wrapper by Header.astro.
 *
 * Layout (row):
 *   [Logo]  [â† snap scroll nav: ë§›ì§‘ í•œì‹ ì–‘ì‹ ... ì¹´í˜ í•«í”Œ ... ì—¬í–‰ ...]  [ğŸŒ][ğŸ”]
 *
 * Navigation rules (from ui-specs.md):
 *   - scroll-snap-type: x mandatory  â†’  each nav item snaps
 *   - mask-image fade on the right    â†’  scroll-hint UX without JS
 *   - NO hamburger, NO drawer
 *
 * PERF: Pure CSS scroll snapping â€” zero JavaScript.
 *       mask-image is paint-only, no layout cost.
 * SEO:  All category + subcategory links are in the DOM (crawlable).
 *       The <nav> element signals navigation landmark to screen readers.
 */

import { getCategoryTree } from "@/lib/i18n/categories";
import { getLocalePath } from "@/lib/i18n/locales";
import { t } from "@/lib/i18n/translations";
import { LOCALES, LOCALE_LABELS } from "@/types/common";
import type { Locale } from "@/types/common";

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;

const categories = getCategoryTree(locale);
const homeHref = getLocalePath("/", locale);
---

<header class="w-full bg-white border-b border-gray-100">
  <div class="flex items-center h-14 px-4 gap-3">

    {/* Logo â€” smaller on mobile */}
    <a
      href={homeHref}
      class="flex-shrink-0 text-base font-bold text-rose-500 tracking-tight hover:text-rose-600 transition-colors duration-150"
      aria-label="ì„¸ì€ë¡œê·¸ í™ˆìœ¼ë¡œ ì´ë™"
    >
      ì„¸ì€ë¡œê·¸
    </a>

    {/*
      Horizontal snap-scroll navigation.
      Contains category headings AND all subcategory items as a flat scrollable row.

      CSS notes:
        - overflow-x: auto + scrollbar hidden via [-ms-overflow-style:none] and [scrollbar-width:none]
        - scroll-snap-type: x mandatory â€” each item snaps on touch/flick
        - mask-image fade-right â€” visual hint that more content is scrollable
        - flex-nowrap ensures items stay on one line

      PERF: mask-image and overflow properties are GPU-accelerated (compositor layer).
            No JS scroll listener needed.
    */}
    <nav
      aria-label="Category navigation"
      class="flex-1 min-w-0 overflow-x-auto flex items-center gap-1 scroll-smooth"
      style="
        scroll-snap-type: x mandatory;
        -ms-overflow-style: none;
        scrollbar-width: none;
        mask-image: linear-gradient(to right, black 85%, transparent 100%);
        -webkit-mask-image: linear-gradient(to right, black 85%, transparent 100%);
      "
    >
      {/*
        Flat row: category label (bold), then its subcategory links.
        All items share the same row â€” no hierarchy shown visually,
        but semantic grouping via data-category helps future JS if needed.
      */}
      {
        categories.map((category) => (
          <>
            {/* Category separator chip */}
            <a
              href={getLocalePath(`/${category.slug}/`, locale)}
              class="flex-shrink-0 scroll-snap-align-start px-3 py-1.5 rounded-full text-xs font-bold text-white bg-rose-500 hover:bg-rose-600 transition-colors duration-150 whitespace-nowrap"
              style="scroll-snap-align: start;"
              data-category={category.slug}
            >
              {category.label}
            </a>

            {/* Subcategory pills */}
            {category.subCategories.map((sub) => (
              <a
                href={getLocalePath(`/${category.slug}/${sub.slug}/`, locale)}
                class="flex-shrink-0 px-3 py-1.5 rounded-full text-xs font-medium text-gray-600 bg-gray-100 hover:bg-rose-50 hover:text-rose-500 transition-colors duration-150 whitespace-nowrap"
                style="scroll-snap-align: start;"
                data-category={category.slug}
                data-sub-category={sub.slug}
              >
                {sub.label}
              </a>
            ))}
          </>
        ))
      }

      {/* Trailing spacer so last items aren't clipped by the mask fade */}
      <span class="flex-shrink-0 w-12 aria-hidden" aria-hidden="true" />
    </nav>

    {/* Right actions: Language + Search */}
    <div class="flex-shrink-0 flex items-center gap-2">

      {/* Language â€” links to locale root; no dropdown on mobile to keep it simple */}
      <a
        href={getLocalePath("/", locale)}
        class="flex items-center justify-center w-8 h-8 text-gray-600 hover:text-rose-500 transition-colors duration-150 rounded-md"
        aria-label={t("nav.language", locale)}
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="2" y1="12" x2="22" y2="12" />
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
        </svg>
      </a>

      {/* Search */}
      <a
        href={getLocalePath("/search/", locale)}
        class="flex items-center justify-center w-8 h-8 text-gray-600 hover:text-rose-500 transition-colors duration-150 rounded-md"
        aria-label={t("nav.search", locale)}
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
      </a>

    </div>
  </div>
</header>

{/* Hide scrollbar for webkit browsers â€” must be in a <style> block */}
<style>
  nav::-webkit-scrollbar {
    display: none;
  }
</style>
