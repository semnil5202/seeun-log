---
/** 같은 서브카테고리의 인근 포스트 목록. */

import { getLocalePath } from "@/shared/lib/i18n/locales";
import type { LocalizedPost } from "@/shared/types/post";
import type { Locale } from "@/shared/types/common";

interface Props {
  posts: LocalizedPost[];
  currentSlug: string;
  categoryLabel: string;
  subCategoryLabel: string;
  nearbyLabel: string;
  moreLabel: string;
  subCategoryHref: string;
  locale: Locale;
}

const {
  posts,
  currentSlug,
  categoryLabel,
  subCategoryLabel,
  nearbyLabel,
  moreLabel,
  subCategoryHref,
  locale,
} = Astro.props;
---

{posts.length > 0 && (
  <section class="mt-12">
    <div class="flex items-center justify-between pb-3 border-b border-gray-200">
      <h2 class="text-[16px] lg:text-[18px] font-semibold text-gray-900">
        {categoryLabel} › {subCategoryLabel} {nearbyLabel}
      </h2>
      <a
        href={subCategoryHref}
        class="text-sm text-gray-500 hover:text-primary-500 transition-colors duration-150"
      >
        {moreLabel} &gt;
      </a>
    </div>

    <ul role="list">
      {posts.map((item) => {
        const isCurrent = item.slug === currentSlug;
        const href = getLocalePath(
          `/${item.category}/${item.sub_category}/${item.slug}/`,
          locale,
        );
        return (
          <li class:list={[
            "border-b border-gray-100",
            isCurrent && "border-l-2 border-l-primary-500",
          ]}>
            <a
              href={href}
              class:list={[
                "flex items-center gap-4 py-4 hover:bg-gray-50 transition-colors duration-150",
                isCurrent ? "pl-3" : "pl-0",
              ]}
              aria-current={isCurrent ? "page" : undefined}
            >
              <div class="flex-1 min-w-0">
                <span class:list={[
                  "block text-base font-semibold leading-snug mb-1 truncate",
                  isCurrent ? "text-primary-600" : "text-gray-900",
                ]}>
                  {item.title}
                </span>
                <p class="text-sm text-gray-500 line-clamp-2 leading-relaxed">
                  {item.description}
                </p>
              </div>
              <div class="shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-gray-100">
                <img
                  src={item.thumbnail}
                  alt={item.title}
                  width={80}
                  height={80}
                  loading="lazy"
                  decoding="async"
                  class="w-full h-full object-cover"
                />
              </div>
            </a>
          </li>
        );
      })}
    </ul>
  </section>
)}
