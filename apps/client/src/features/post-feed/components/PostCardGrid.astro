---
/** 포스트 피드를 단일 컬럼 리스트로 렌더링한다. 모바일 인피드 광고 슬롯 포함. */
import type { Post } from "@/shared/types/post";
import type { Locale } from "@/shared/types/common";
import PostCard from "./PostCard.astro";
import SponsoredCard from "./SponsoredCard.astro";

interface Props {
  posts: Post[];
  locale: Locale;
}

const { posts, locale } = Astro.props;

type GridItem =
  | { type: "post"; post: Post; cardIndex: number }
  | { type: "ad"; adIndex: number };

const gridItems: GridItem[] = [];
let cardIndex = 0;

for (let i = 0; i < posts.length; i++) {
  if (cardIndex === 1 || cardIndex === 3) {
    gridItems.push({ type: "ad", adIndex: cardIndex === 1 ? 1 : 2 });
  }

  gridItems.push({ type: "post", post: posts[i]!, cardIndex });
  cardIndex++;
}
---

<div class="flex flex-col gap-10">
  {gridItems.map((item) => {
    if (item.type === "ad") {
      return (
        <div
          class="block lg:hidden"
          aria-label={`Advertisement ${item.adIndex}`}
          role="complementary"
        >
          <div class="w-full min-h-[100px] bg-gray-100 rounded-xl flex items-center justify-center border border-dashed border-gray-300">
            <span class="text-xs text-gray-400 font-normal tracking-wide uppercase select-none">
              Ad
            </span>
          </div>
        </div>
      );
    }

    if (item.post.is_sponsored) {
      return (
        <SponsoredCard
          post={item.post}
          locale={locale}
          index={item.cardIndex}
        />
      );
    }

    return (
      <PostCard
        post={item.post}
        locale={locale}
        index={item.cardIndex}
      />
    );
  })}
</div>
