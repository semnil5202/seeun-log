---
/** 포스트 피드를 단일 컬럼 리스트로 렌더링한다. 2번째, 6번째 슬롯에 인피드 광고 삽입. */
import type { Post } from "@/shared/types/post";
import type { Locale } from "@/shared/types/common";
import PostCard from "./PostCard.astro";
import SponsoredCard from "./SponsoredCard.astro";

interface Props {
  posts: Post[];
  locale: Locale;
}

const { posts, locale } = Astro.props;

type FeedItem =
  | { type: "post"; post: Post; cardIndex: number }
  | { type: "ad" };

const feedItems: FeedItem[] = [];
let cardIndex = 0;

for (let i = 0; i < posts.length; i++) {
  if (cardIndex === 1 || cardIndex === 5) {
    feedItems.push({ type: "ad" });
  }

  feedItems.push({ type: "post", post: posts[i]!, cardIndex });
  cardIndex++;
}
---

<div class="flex flex-col gap-10">
  {feedItems.map((item) => {
    if (item.type === "ad") {
      return (
        <div
          role="complementary"
          aria-label="Advertisement"
        >
          <div class="w-full h-[250px] bg-gray-100 rounded-xl flex items-center justify-center">
            <span class="text-body2 text-gray-400 select-none">In-feed Adsense</span>
          </div>
        </div>
      );
    }

    if (item.post.is_sponsored) {
      return (
        <SponsoredCard
          post={item.post}
          locale={locale}
          index={item.cardIndex}
        />
      );
    }

    return (
      <PostCard
        post={item.post}
        locale={locale}
        index={item.cardIndex}
      />
    );
  })}
</div>
