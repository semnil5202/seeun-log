---
/** 추천 포스트 카드. primary 컬러 배지로 일반 카드와 시각적으로 구분한다. */
import type { Post } from "@/shared/types/post";
import type { Locale } from "@/shared/types/common";
import { getCategoryLabel } from "@/shared/lib/i18n/categories";
import { getLocalePath } from "@/shared/lib/i18n/locales";
import { t } from "@/shared/lib/i18n/translations";

interface Props {
  post: Post;
  locale: Locale;
  index: number;
}

const { post, locale, index } = Astro.props;

const isLcp = index === 0;
const postPath = `/${post.category}/${post.sub_category}/${post.slug}/`;
const localizedHref = getLocalePath(postPath, locale);

const categoryLabel = getCategoryLabel(post.category, locale);
const sponsoredLabel = t("post.sponsored", locale);
const dateStr = new Date(post.created_at).toLocaleDateString(locale, {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<article class="group">
  <a href={localizedHref} class="block">
    <div class="relative w-full aspect-7/3 overflow-hidden rounded-xl bg-gray-100">
      <img
        src={post.thumbnail}
        alt={post.title}
        width="640"
        height="180"
        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
        loading={isLcp ? "eager" : "lazy"}
        fetchpriority={isLcp ? "high" : "auto"}
        decoding={isLcp ? "sync" : "async"}
      />

      <span class="absolute top-3 left-3 text-xs font-bold text-white bg-primary-400 rounded-full px-2.5 py-0.5">
        {sponsoredLabel}
      </span>
    </div>

    <div class="mt-4 flex flex-col gap-2">
      <h2 class="text-title2 font-bold text-gray-900 line-clamp-2 group-hover:text-primary-600 transition-colors">
        {post.title}
      </h2>

      <p class="text-body2 text-gray-500 line-clamp-2">
        {post.description}
      </p>

      <div class="flex items-center gap-1.5 text-caption1 text-gray-400">
        <time datetime={post.created_at}>{dateStr}</time>
        {post.place_name && (
          <>
            <span aria-hidden="true">&middot;</span>
            <span>{post.place_name}</span>
          </>
        )}
        <span aria-hidden="true">&middot;</span>
        <span>{categoryLabel}</span>
      </div>
    </div>
  </a>
</article>
