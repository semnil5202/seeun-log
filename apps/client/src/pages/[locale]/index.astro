---
/** 다국어 홈 페이지 (/{locale}/) */

import ListLayout from "@/layouts/ListLayout.astro";
import PostCardGrid from "@/features/post-feed/components/PostCardGrid.astro";
import BreadcrumbJsonLd from "@/shared/components/seo/BreadcrumbJsonLd.astro";
import { LOCALES, DEFAULT_LOCALE } from "@/shared/types/common";
import type { Locale } from "@/shared/types/common";
import type { LocalizedPost } from "@/shared/types/post";
import { getPaginatedPosts, getSponsoredPosts } from "@/features/post-feed/api/posts";
import { getLocalizedPost } from "@/features/post-feed/api/translations";
import { t } from "@/shared/lib/i18n/translations";

export async function getStaticPaths() {
  const nonDefaultLocales = LOCALES.filter((l) => l !== DEFAULT_LOCALE);

  return nonDefaultLocales.map((locale) => ({
    params: { locale },
    props: { locale },
  }));
}

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;

const [{ posts, totalPages }, sponsored] = await Promise.all([
  getPaginatedPosts(1),
  getSponsoredPosts(),
]);

const localizedPosts = await Promise.all(posts.map((p) => getLocalizedPost(p, locale)));
const sponsoredLocalized: LocalizedPost[] = await Promise.all(
  sponsored.map((p) => getLocalizedPost(p, locale))
);

const canonical = `/${locale}/`;
const path = "/";

const homeLabel = t("nav.home", locale);
const breadcrumbItems = [{ name: homeLabel, url: "/" }];

const pageTitle = `${homeLabel} - seeun log`;
const SITE_DESCRIPTION =
  "세은로그 — 커플이 함께 다녀온 맛집, 카페, 여행지를 솔직하게 리뷰합니다.";
---

<ListLayout
  title={pageTitle}
  description={SITE_DESCRIPTION}
  canonical={canonical}
  path={path}
  locale={locale}
  sponsoredPosts={sponsoredLocalized}
>
  <BreadcrumbJsonLd slot="head" items={breadcrumbItems} />

  <PostCardGrid
    posts={localizedPosts}
    locale={locale}
    feedEndpoint={`/api/feed/${locale}/all/`}
    hasNextPage={totalPages > 1}
    sponsoredLabel={t("post.sponsored", locale)}
  />
</ListLayout>
