---
/** 한국어 검색 페이지 (/search/) */

import ListLayout from "@/layouts/ListLayout.astro";
import SearchUI from "@/features/search/components/SearchUI.astro";
import { buildSearchData } from "@/features/search/api/search-data";
import { DEFAULT_LOCALE } from "@/shared/types/common";
import type { LocalizedPost } from "@/shared/types/post";
import { getAllPosts, getSponsoredPosts } from "@/features/post-feed/api/posts";
import { t } from "@/shared/lib/i18n/translations";

const locale = DEFAULT_LOCALE;

const [allPosts, sponsored] = await Promise.all([
  getAllPosts(),
  getSponsoredPosts(),
]);

const localizedPosts: LocalizedPost[] = allPosts.map((p) => ({ ...p, locale }));
const sponsoredLocalized: LocalizedPost[] = sponsored.map((p) => ({ ...p, locale }));

const { searchData, suggestedKeywords } = buildSearchData(localizedPosts, locale);

const placeholderText = t("search.placeholder", locale);
const noResultsText = t("search.noResults", locale);
const noResultsHintText = t("search.noResultsHint", locale);
const resultsText = t("search.results", locale);
const suggestedText = t("search.suggested", locale);
const sponsoredLabel = t("post.sponsored", locale);
---

<ListLayout
  title="검색 - 세은로그"
  description="세은로그 검색 — 맛집, 카페, 여행 게시글을 검색합니다."
  canonical="/search/"
  path="/search/"
  locale={locale}
  sponsoredPosts={sponsoredLocalized}
>
  <Fragment slot="head">
    <meta name="robots" content="noindex, follow" />
  </Fragment>

  <SearchUI
    searchData={searchData}
    suggestedKeywords={suggestedKeywords}
    placeholderText={placeholderText}
    noResultsText={noResultsText}
    noResultsHintText={noResultsHintText}
    resultsText={resultsText}
    suggestedText={suggestedText}
    sponsoredLabel={sponsoredLabel}
  />
</ListLayout>
