---
/** 한국어 카테고리 인덱스 (/{category}/) */

import ListLayout from "@/layouts/ListLayout.astro";
import PostCardGrid from "@/features/post-feed/components/PostCardGrid.astro";
import Pagination from "@/shared/components/navigation/Pagination.astro";
import BreadcrumbJsonLd from "@/shared/components/seo/BreadcrumbJsonLd.astro";
import { DEFAULT_LOCALE } from "@/shared/types/common";
import type { LocalizedPost } from "@/shared/types/post";
import { CATEGORY_SLUGS } from "@/shared/types/category";
import type { CategorySlug } from "@/shared/types/category";
import {
  getPaginatedPostsByCategory,
  getSponsoredPosts,
  getRecommendedPosts,
} from "@/features/post-feed/api/posts";
import { getCategoryLabel } from "@/shared/lib/i18n/categories";

export async function getStaticPaths() {
  return CATEGORY_SLUGS.map((category) => ({
    params: { category },
    props: { category },
  }));
}

interface Props {
  category: CategorySlug;
}

const { category } = Astro.props;
const locale = DEFAULT_LOCALE;

const [{ posts, totalPages }, sponsored, recommended] = await Promise.all([
  getPaginatedPostsByCategory(category, 1),
  getSponsoredPosts(),
  getRecommendedPosts(),
]);

const sponsoredLocalized: LocalizedPost[] = sponsored.map((p) => ({ ...p, locale }));
const recommendedLocalized: LocalizedPost[] = recommended.map((p) => ({ ...p, locale }));

const categoryLabel = getCategoryLabel(category, locale);
const canonical = `/${category}/`;
const path = `/${category}/`;

const breadcrumbItems = [
  { name: "홈", url: "/" },
  { name: categoryLabel, url: `/${category}/` },
];

const pageTitle = `${categoryLabel} - 세은로그`;
const pageDescription = `세은로그 ${categoryLabel} 카테고리 — 커플이 직접 다녀온 ${categoryLabel} 장소 리뷰 모음.`;
---

<ListLayout
  title={pageTitle}
  description={pageDescription}
  canonical={canonical}
  path={path}
  locale={locale}
  sponsoredPosts={sponsoredLocalized}
  recommendedPosts={recommendedLocalized}
>
  <BreadcrumbJsonLd slot="head" items={breadcrumbItems} />

  <PostCardGrid posts={posts} locale={locale} />

  {totalPages > 1 && (
    <Pagination
      currentPage={1}
      totalPages={totalPages}
      baseUrl={canonical}
      locale={locale}
    />
  )}
</ListLayout>
