---
/**
 * src/pages/index.astro — Korean home page (/)
 *
 * Rendering: SSG (Astro default). Built once at deploy time.
 * Locale: ko (DEFAULT_LOCALE) — no URL prefix per astro.config.mjs prefixDefaultLocale: false.
 *
 * SEO:
 *   - canonical: "/"
 *   - BreadcrumbJsonLd: Home only (injected into <head> via named slot)
 *   - hreflang entries generated by BaseHead > Hreflang component (path="/")
 *
 * Data fetching: all queries run at build time (zero runtime compute cost).
 * COST: 3 parallel queries → getPaginatedPosts + getSponsoredPosts + getRecommendedPosts.
 *       On Supabase migration these become 3 index-only reads (created_at, is_sponsored, is_recommended).
 */

import ListLayout from "@/layouts/ListLayout.astro";
import PostCardGrid from "@/components/post/PostCardGrid.astro";
import Pagination from "@/components/navigation/Pagination.astro";
import BreadcrumbJsonLd from "@/components/seo/BreadcrumbJsonLd.astro";
import { DEFAULT_LOCALE } from "@/types/common";
import type { LocalizedPost } from "@/types/post";
import { getPaginatedPosts, getSponsoredPosts, getRecommendedPosts } from "@/lib/api/posts";

const locale = DEFAULT_LOCALE;

// PERF: Parallel fetch — all 3 queries resolve concurrently at build time.
const [{ posts, totalPages }, sponsored, recommended] = await Promise.all([
  getPaginatedPosts(1),
  getSponsoredPosts(),
  getRecommendedPosts(),
]);

// Cast Post[] → LocalizedPost[]: Korean is the source language so no translation needed.
const sponsoredLocalized: LocalizedPost[] = sponsored.map((p) => ({ ...p, locale }));
const recommendedLocalized: LocalizedPost[] = recommended.map((p) => ({ ...p, locale }));

const breadcrumbItems = [{ name: "홈", url: "/" }];

const SITE_DESCRIPTION =
  "세은로그 — 커플이 함께 다녀온 맛집, 카페, 여행지를 솔직하게 리뷰합니다.";
---

<ListLayout
  title="세은로그 - 맛집, 카페, 여행 커플 블로그"
  description={SITE_DESCRIPTION}
  canonical="/"
  path="/"
  locale={locale}
  sponsoredPosts={sponsoredLocalized}
  recommendedPosts={recommendedLocalized}
>
  {/* SEO: BreadcrumbJsonLd injected into <head> via the named "head" slot */}
  <BreadcrumbJsonLd slot="head" items={breadcrumbItems} />

  <PostCardGrid posts={posts} locale={locale} />

  {totalPages > 1 && (
    <Pagination
      currentPage={1}
      totalPages={totalPages}
      baseUrl="/"
      locale={locale}
    />
  )}
</ListLayout>
